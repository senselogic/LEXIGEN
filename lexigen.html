<meta charset="utf-8">
<style>
    *
    {
        padding: 0;
        margin: 0;
    }

    table
    {
        border-collapse: collapse;
    }

    html,
    table,
    input,
    button,
    textarea
    {
        font-size: 1vw;
    }

    .text
    {
        overflow: scroll;
        resize: none;
        white-space: pre;
        width: calc( 100vw / 7 );
        height: 82vh;
    }

    .input
    {
        width: calc( 100vw / 7 );
        height: 5vh;
        font-size: 1vw;
    }

    .checkbox
    {
        font-size: 0.7vw;
    }
</style>
<table>
    <tbody>
        <tr>
            <td>
                <textarea id="BaseText" class="text" placeholder="Base Text" spellcheck="false"></textarea>
            </td>
            <td>
                <textarea id="TranslatedText" class="text" placeholder="Translated Text" spellcheck="false"></textarea>
            </td>
            <td>
                <textarea id="TranslationText1" class="text" placeholder="Translation Text" spellcheck="false"></textarea>
            </td>
            <td>
                <textarea id="TranslationText2" class="text" placeholder="Translation Text" spellcheck="false"></textarea>
            </td>
            <td>
                <textarea id="TranslationText3" class="text" placeholder="Translation Text" spellcheck="false"></textarea>
            </td>
            <td>
                <textarea id="TranslationText4" class="text" placeholder="Translation Text" spellcheck="false"></textarea>
            </td>
            <td>
                <textarea id="MergedText" class="text" placeholder="Merged Text" spellcheck="false"></textarea>
            </td>
        </tr>
        <tr>
            <td>
                <input id="BaseTextSize" class="input" type="text" placeholder="Base Text Size" disabled="disabled"/>
            </td>
            <td>
                <input id="TranslatedTextSize" class="input" type="text" placeholder="Translated Text Size" disabled="disabled"/>
            </td>
            <td>
                <input id="TranslationTextSize1" class="input" type="text" placeholder="Translation Text Size" disabled="disabled"/>
            </td>
            <td>
                <input id="TranslationTextSize2" class="input" type="text" placeholder="Translation Text Size" disabled="disabled"/>
            </td>
            <td>
                <input id="TranslationTextSize3" class="input" type="text" placeholder="Translation Text Size" disabled="disabled"/>
            </td>
            <td>
                <input id="TranslationTextSize4" class="input" type="text" placeholder="Translation Text Size" disabled="disabled"/>
            </td>
            <td>
                <input id="MergedTextSize" class="input" type="text" placeholder="Translation Text Size" disabled="disabled"/>
            </td>
        </tr>
        <tr>
            <td>
                <div class="checkbox">
                    <input id="BaseIsTrimmed" type="checkbox"/>&nbsp;trim
                </div>
                <div class="checkbox">
                    <input id="BaseIsCapitalized" type="checkbox"/>&nbsp;capitalize&nbsp;
                    <input id="BaseIsPunctuated" type="checkbox"/>&nbsp;punctuate
                </div>
                <div class="checkbox">
                    <input id="BaseIsUncapitalized" type="checkbox"/>&nbsp;uncapitalize&nbsp;
                    <input id="BaseIsUnpunctuated" type="checkbox"/>&nbsp;unpunctuate
                </div>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
                <div class="checkbox">
                    <input id="TranslationIsTrimmed" type="checkbox"/>&nbsp;trim
                </div>
                <div class="checkbox">
                    <input id="TranslationIsCapitalized" type="checkbox"/>&nbsp;capitalize&nbsp;
                    <input id="TranslationIsPunctuated" type="checkbox"/>&nbsp;punctuate
                </div>
                <div class="checkbox">
                    <input id="TranslationIsUncapitalized" type="checkbox"/>&nbsp;uncapitalize&nbsp;
                    <input id="TranslationIsUnpunctuated" type="checkbox"/>&nbsp;unpunctuate
                </div>
            </td>
        </tr>
        <tr>
            <td>
                <button onclick="Apply()">Apply</button>
            </td>
            <td>
            </td>
            <td>
                <input id="PrefixArray" class="input" type="text" placeholder="Prefix List"/>
            </td>
            <td>
                <input id="SuffixArray" class="input" type="text" placeholder="Suffix List"/>
            </td>
            <td>
                <input id="TranslationSeparator" class="input" type="text" placeholder="Translation Separator" value="/"/>
            </td>
            <td>
            </td>
            <td>
                <button onclick="Apply()">Apply</button>
            </td>
        </tr>
    </tbody>
</table>
<script>
    // -- FUNCTIONS

    function GetTextSize(
        text_element_id
        )
    {
        return (
            document.getElementById( text_element_id ).value.split( "\n" ).length
              + " lines, "
              + document.getElementById( text_element_id ).value.length
              + " characters"
            );
    }

    // ~~

    function UpdateTextSize(
        event
        )
    {
        document.getElementById( "BaseTextSize" ).value = GetTextSize( "BaseText" );
        document.getElementById( "TranslatedTextSize" ).value = GetTextSize( "TranslatedText" );
        document.getElementById( "TranslationTextSize1" ).value = GetTextSize( "TranslationText1" );
        document.getElementById( "TranslationTextSize2" ).value = GetTextSize( "TranslationText2" );
        document.getElementById( "TranslationTextSize3" ).value = GetTextSize( "TranslationText3" );
        document.getElementById( "TranslationTextSize4" ).value = GetTextSize( "TranslationText4" );
        document.getElementById( "MergedTextSize" ).value = GetTextSize( "MergedText" );
    }

    // ~~

    function GetCapitalizedLine(
        line
        )
    {
        if ( line.length <= 1 )
        {
            return line.toUpperCase();
        }
        else
        {
            return line[ 0 ].toUpperCase() + line.substring( 1 );
        }
    }

    // ~~

    function GetUncapitalizedLine(
        line
        )
    {
        if ( line.length <= 1 )
        {
            return line.toLowerCase();
        }
        else
        {
            return line[ 0 ].toLowerCase() + line.substring( 1 );
        }
    }

    // ~~

    function GetPunctuatedLine(
        line
        )
    {
        if ( line.length > 0
             && ".!?".indexOf( line[ line.length - 1 ] ) < 0 )
        {
            return line + ".";
        }
        else
        {
            return line;
        }
    }

    // ~~

    function GetUnpunctuatedLine(
        line
        )
    {
        if ( line.length > 0
             && ".".indexOf( line[ line.length - 1 ] ) >= 0 )
        {
            return line.substring( 0, line.length - 1 );
        }
        else
        {
            return line;
        }
    }

    // ~~

    function HasValidPrefix(
        line,
        prefix_array
        )
    {
        var
            prefix_index;

        if ( prefix_array.length == 0 )
        {
            return true;
        }
        else
        {
            for ( prefix_index = 0;
                  prefix_index < prefix_array.length;
                  ++prefix_index )
            {
                if ( line.startsWith( prefix_array[ prefix_index ] ) )
                {
                    return true;
                }
            }

            return false;
        }
    }

    // ~~

    function HasValidSuffix(
        line,
        suffix_array
        )
    {
        var
            suffix_index;

        if ( suffix_array.length == 0 )
        {
            return true;
        }
        else
        {
            for ( suffix_index = 0;
                  suffix_index < suffix_array.length;
                  ++suffix_index )
            {
                if ( line.endsWith( suffix_array[ suffix_index ] ) )
                {
                    return true;
                }
            }

            return false;
        }
    }

    // ~~

    function Apply()
    {
        var
            base_line,
            base_line_is_capitalized,
            base_line_is_punctuated,
            base_line_is_trimmed,
            base_line_is_uncapitalized,
            base_line_is_unpunctuated,
            merged_line_array,
            merged_line_index,
            prefix_array,
            suffix_array,
            base_line_array,
            merged_line_count,
            translated_line_array,
            translation_array,
            translation_count_map,
            translation_line,
            translation_line_array,
            translation_line_array_array,
            translation_line_count,
            translation_separator,
            translation_line_is_capitalized,
            translation_line_is_punctuated,
            translation_line_is_trimmed,
            translation_line_is_uncapitalized,
            translation_line_is_unpunctuated,
            translation_text_count,
            translation_text_index;

        base_line_array = document.getElementById( "BaseText" ).value.split( "\n" );
        merged_line_count = base_line_array.length;

        translated_line_array = [];
        translated_line_array.length = merged_line_count;

        translation_line_array_array = [];
        translation_text_count = 4;

        for ( translation_text_index = 0;
              translation_text_index < translation_text_count;
              ++translation_text_index )
        {
            translation_line_array
                = document.getElementById(
                      "TranslationText" + ( translation_text_index + 1 )
                      ).value.split( "\n" );

            translation_line_count = translation_line_array.length;

            if ( translation_line_count > merged_line_count )
            {
                merged_line_count = translation_line_count;
            }

            translation_line_array_array.push( translation_line_array );

        }

        merged_line_array = [];
        merged_line_array.length = merged_line_count;

        prefix_array = document.getElementById( "PrefixArray" ).value.split( "," );
        suffix_array = document.getElementById( "SuffixArray" ).value.split( "," );
        translation_separator = document.getElementById( "TranslationSeparator" ).value;

        base_line_is_trimmed = document.getElementById( "BaseIsTrimmed" ).checked;
        base_line_is_capitalized = document.getElementById( "BaseIsCapitalized" ).checked;
        base_line_is_uncapitalized = document.getElementById( "BaseIsUncapitalized" ).checked;
        base_line_is_punctuated = document.getElementById( "BaseIsPunctuated" ).checked;
        base_line_is_unpunctuated = document.getElementById( "BaseIsUnpunctuated" ).checked;

        translation_line_is_trimmed = document.getElementById( "TranslationIsTrimmed" ).checked;
        translation_line_is_capitalized = document.getElementById( "TranslationIsCapitalized" ).checked;
        translation_line_is_uncapitalized = document.getElementById( "TranslationIsUncapitalized" ).checked;
        translation_line_is_punctuated = document.getElementById( "TranslationIsPunctuated" ).checked;
        translation_line_is_unpunctuated = document.getElementById( "TranslationIsUnpunctuated" ).checked;

        for ( merged_line_index = 0;
              merged_line_index < merged_line_count;
              ++merged_line_index )
        {
            base_line = base_line_array[ merged_line_index ];

            if ( base_line_is_trimmed )
            {
                base_line = base_line.trim();
            }

            if ( base_line_is_capitalized )
            {
                base_line = GetCapitalizedLine( base_line );
            }

            if ( base_line_is_uncapitalized )
            {
                base_line = GetUncapitalizedLine( base_line );
            }

            if ( base_line_is_punctuated )
            {
                base_line = GetPunctuatedLine( base_line );
            }

            if ( base_line_is_unpunctuated )
            {
                base_line = GetUnpunctuatedLine( base_line );
            }

            translated_line_array[ merged_line_index ] = base_line;

            translation_count_map = new Map();

            for ( translation_text_index = 0;
                  translation_text_index < translation_text_count;
                  ++translation_text_index )
            {
                translation_line_array = translation_line_array_array[ translation_text_index ];
                translation_line_count = translation_line_array.length;

                if ( merged_line_index < translation_line_count )
                {
                    translation_line = translation_line_array[ merged_line_index ];

                    if ( translation_line_is_trimmed )
                    {
                        translation_line = translation_line.trim();
                    }

                    if ( translation_line_is_capitalized )
                    {
                        translation_line = GetCapitalizedLine( translation_line );
                    }

                    if ( translation_line_is_uncapitalized )
                    {
                        translation_line = GetUncapitalizedLine( translation_line );
                    }

                    if ( translation_line_is_punctuated )
                    {
                        translation_line = GetPunctuatedLine( translation_line );
                    }

                    if ( translation_line_is_unpunctuated )
                    {
                        translation_line = GetUnpunctuatedLine( translation_line );
                    }

                    if ( translation_line != ""
                         && HasValidPrefix( translation_line, prefix_array )
                         && HasValidSuffix( translation_line, suffix_array ) )
                    {
                        if ( translation_count_map.has( translation_line ) )
                        {
                            translation_count_map.set(
                                translation_line,
                                translation_count_map.get( translation_line ) + 1
                                );
                        }
                        else
                        {
                            translation_count_map.set( translation_line, 1 );
                        }
                    }
                }
            }

            translation_array
                = [ ...translation_count_map.entries() ].sort(
                    function ( first_translation_count_entry, second_translation_count_entry )
                    {
                        return second_translation_count_entry[ 1 ] - first_translation_count_entry[ 1 ];
                    }
                    ).map(
                        function ( translation_count_entry )
                        {
                            return translation_count_entry[ 0 ];
                        }
                        );

            merged_line_array[ merged_line_index ] = translation_array.join( translation_separator );
        }

        document.getElementById( "TranslatedText" ).value = translated_line_array.join( "\n" );
        document.getElementById( "MergedText" ).value = merged_line_array.join( "\n" );

        UpdateTextSize();
    }

    // ~~

    function SynchronizeScroll(
        event
        )
    {
        var
            text_element,
            text_element_array;

        text_element_array = document.getElementsByClassName( "text" );

        for ( text_element of text_element_array )
        {
            text_element.scrollTop = this.scrollTop;
        }
    }

    // -- STATEMENTS

    var
        text_element,
        text_element_array;

    text_element_array = document.getElementsByClassName( "text" );

    for ( text_element of text_element_array )
    {
        text_element.addEventListener( "scroll", SynchronizeScroll, false );
    }

    UpdateTextSize();

    document.getElementById( "BaseText" ).addEventListener( "input", UpdateTextSize, false );
    document.getElementById( "TranslationText1" ).addEventListener( "input", UpdateTextSize, false );
    document.getElementById( "TranslationText2" ).addEventListener( "input", UpdateTextSize, false );
    document.getElementById( "TranslationText3" ).addEventListener( "input", UpdateTextSize, false );
    document.getElementById( "TranslationText4" ).addEventListener( "input", UpdateTextSize, false );
    document.getElementById( "MergedText" ).addEventListener( "input", UpdateTextSize, false );
</script>
